# 加密与压缩

## 目录
1. [用户视角的应用](#1-用户视角的应用)
2. [程序概览](#2-程序概览)
3. [程序结构初步设计](#3-程序结构初步设计)
   - [3.1 程序结构及要点](#31-程序结构及要点)
   - [3.2 初步设计](#32-初步设计)
4. [底层细节与技术](#4-底层细节与技术)
   - [4.1 技术整合与分析](#41-技术整合与分析)
   - [4.2 关键技术点](#42-关键技术点)
5. [算法具体实现](#5-算法具体实现)
   - [5.1 实现方案](#51-实现方案)
   - [5.2 疑难问题的解决方案](#52-疑难问题的解决方案)
   - [5.3 优化与改进](#53-优化与改进)
6. [安全问题](#6-安全问题)
   - [6.1 Aes的安全性问题](#61-aes的安全性问题)
   - [6.2 数据完整性问题](#62-数据完整性问题)
   - [6.3 系统安全考虑](#63-系统安全考虑)
7. [最终实现](#7-最终实现)
   - [7.1 程序的运行流程](#71-程序的运行流程)

## 1. 用户视角的应用
- 见"策划.md"

## 2. 程序概览
- 见"策划.md"

## 3. 程序结构初步设计

### 3.1 程序结构及要点

**Encryption/Decryption_System**  
负责加密与解密工作，与压缩端以二进制数据进行通信。  
需要打包为线程。

**Compress/Decompress_System**  
负责压缩与解压。  
需要打包为线程。

**BufferPool**  
- 缓存以上两者的输出
- 充当可接受线程动态调度的对象
- 每个线程组独立使用一个缓存池
- 加入大小限制和溢出处理机制
- 仅充当被调度对象

**ThreadManager**  
- 负责在线程尺度下调度一级线程
- 若引入多线程，需要管理二级线程
- 优先级和资源分配策略

**ErrorCollector**  
负责对错误的检测与收集，生成并且输出相关错误报告(日志)

### 3.2 初步设计

**Aes**  
技术点(适配技术)：
1. 密钥hash处理
2. 尾部补全与去除
3. 缓存池
(全部已完成)

**Heffman**  
1. 希望所有即将引入的压缩算法能整合多文件为单文件并输出
2. (待补充)
3. (待补充)

**Combination**  
示意：Heffman-(1)>Aes-(2)>.sy文件(实际为二进制)

1. 单流程：模块化的独立线程处理
   - **I:线程管理**
     * 将heffman与aes作为单独线程
     * 使用无锁队列或批量传输减少同步开销
     * 可优化：按照算法耗时管理线程并行数量
   - **II:io**
     * 从缓冲池接收压缩端的输出，加密
   - **III:方案的优点**
     * 支持未来的新增算法
     * 处理流程的高度可定义性
   - **IV:面临的问题**
     * 需缓冲区管理、线程同步、流量控制
     * 缓冲区可能成为性能瓶颈
     * 需处理跨线程异常和状态一致性

2. 多线程的管理
   - **I:文件分割的管理方法**
     * 加密结束后依据预先传输的顺序表整合加密后的结果
   - **II:** (待补充)

**GUI**  
设计GUI：
- I：多线程模式选择(后续自动检测)
- II：加密、压缩算法切换
- III：引入已加密的标记与加密文件的自动识别、提示输入密码

**Optimization**  
优化：
- **Aes：**
  * I：多线程：可能使用文件分割，需要注意内存和线程数检测
  * II：需要引入id标记分块文件，以便整合为文件输出
  * III：指令集加速(十倍aes提速)
- **Heffman：**
  * I：多线程，部分同Aes
- **Combination：**
  * I：串行多线程(多级线程)
  * II：线程安全

## 4. 底层细节与技术

### 4.1 技术整合与分析
主要技术：
- **加密：**
  * aes-128
- **压缩：**
  * heffman
- **控制：**
  * thread/buffer

分析：
- **加密：**
  * aes-128：128bit密钥，十轮处理，足以应对大多数传统攻击
- **压缩：**
  * heffman基于自然语言重复性的压缩算法
- **控制：**
  * thread/buffer:
    - 线程与线程、线程与缓存池之间的组合与调度
    - 难点在于ThreadManager的实现
      + 一级线程：管理压缩/解压缩、加密/解密的主要处理线程
      + 二级线程：算法内部的并行处理线程(如文件分块处理)

### 4.2 关键技术点
- 线程间通信机制设计
- 缓冲区数据同步方案
- 加密压缩的顺序化处理
- 异常处理和恢复机制

## 5. 算法具体实现

### 5.1 实现方案
- **Aes加密实现：**
  * PKCS#7填充方案
  * 密钥派生函数处理用户密码
- **Heffman压缩实现：**
  * 基于频率统计的编码
  * 动态字典更新机制
  * 并行化文件处理

### 5.2 疑难问题的解决方案
- 加密压缩顺序问题：
  * 采用先压缩后加密的标准流程
- 大数据处理：
  * 引入分块处理机制
- 性能瓶颈：
  * 动态调整线程池大小
- 内存管理：
  * 限制缓冲区最大尺寸

### 5.3 优化与改进
- **性能优化：**
  * SIMD指令加速AES
- **功能扩展：**
  * 支持多种加密算法
  * 增加压缩算法选择
- **用户体验：**
  * 进度显示优化
  * 错误信息友好化

## 6. 安全问题

### 6.1 Aes的安全性问题
- 密钥管理方案设计
- 加密模式选择分析
- 侧信道攻击防范

### 6.2 数据完整性问题
- 校验和机制
- 防篡改设计

### 6.3 系统安全考虑
- 内存敏感数据清理
- 临时文件安全处理
- 权限最小化原则

## 7. 最终实现

### 7.1 程序的运行流程
1. 用户通过GUI选择操作模式(加密/解密、压缩/解压)
2. 选择输入文件和输出路径
3. 输入必要参数(如密码)
4. ThreadManager初始化处理线程
5. 文件分块进入处理流水线
6. 加密/压缩顺序处理
7. 结果写入输出文件
8. 错误处理和日志记录
9. 内存清理和资源释放
